<% include ../partials/summariesheadtabs%>
<% include ../partials/summariesdaterange%>

<div id="summarymessage">
<h4>
  Summaries for tasks between <%=moment(startdate).format('dddd, MMM Do YYYY')%> and <%=moment(enddate).format('dddd, MMM Do YYYY')%>
</h4>
</div>

<div id="summarycharts">
  <table class="columns">
      <tr>
        <td><div id="chart1" style="border: 1px solid #ccc"></div></td>
        <td><div id="chart2" style="border: 1px solid #ccc"></div></td>
        <td><div id="chart3" style="border: 1px solid #ccc"></div></td>
      </tr>
      <tr>
        <td><div id="chart4" style="border: 1px solid #ccc"></div></td>
        <td><div id="chart5" style="border: 1px solid #ccc"></div></td>
        <td><div id="chart6" style="border: 1px solid #ccc"></div></td>
      </tr>
    </table>
  </div>
</div>

<p hidden id='tasksJSON'>
  <%= JSON.stringify(tasks);%>
</p>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.7.0/moment.min.js" type="text/javascript"></script>
  <script type="text/javascript">
    // Load Charts and the corechart package.
    google.charts.load('current', {'packages':['corechart']});
    let tasks =JSON.parse(document.getElementById('tasksJSON').textContent);
    console.log(tasks[0].type);
    let piechart = {
      title: 'Hours by task types',
      columename: ['Task', 'Hours'],
      columetype: ['string', 'number'],
      data: [],
      div: 'chart1'
    };
    let temp = {}
    for (let task of tasks) {
      let a = moment('2016-06-06T21:03:55');
      let b = moment('2016-05-06T20:03:55');
      console.log(task.type);
      if (temp[task.type]) {
        console.log((moment(task.end).diff(moment(task.start), 'minutes')));
        temp[task.type][1] += moment(task.end).diff(moment(task.start), 'minutes');
      } else {
        console.log((moment(task.end).diff(moment(task.start), 'minutes')));
        temp[task.type] = [task.type, moment(task.end).diff(moment(task.start), 'minutes').toFixed(2)]
      }
    };
    for (let item in temp) {
      piechart.data.push(item);
    }
</script>
